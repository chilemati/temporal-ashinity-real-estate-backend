// ---------------------------
// 1. Datasource (PostgreSQL)
// ---------------------------
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ---------------------------
// 2. Prisma Client Generator
// ---------------------------
generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x", "debian-openssl-3.0.x"]
}

// ---------------------------
// 3. Enums
// ---------------------------
enum UserRole {
  normal
  seller
  admin
  superadmin
}

enum PropertySaleStatus {
  AVAILABLE
  SOLD
}

enum PropertyOccupancyStatus {
  VACANT
  RENTED
}

// ---------------------------
// 4. User Model
// ---------------------------
model User {
  id        Int     @id @default(autoincrement())
  email     String  @unique
  phone     String? @unique
  password  String?
  firstName String?
  lastName  String?
  nin       String?
  avatar    String?
  googleId  String? @unique
  kycStatus String? @default("PENDING")

  emailVerified Boolean @default(false)
  phoneVerified Boolean @default(false)

  emailOTP     String?
  phoneOTP     String?
  otpExpiresAt DateTime?

  role UserRole @default(normal)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  properties Property[]

  bought   BoughtProperty[]
  wishlist WishlistProperty[]
  invested InvestedProperty[]
  rented   RentedProperty[]

  // âœ… 1â€“1 relations (NO fields here)
  wallet      Wallet?
  bankAccount BankAccount?
}

// ---------------------------
// 5. Property Model
// ---------------------------
model Property {
  id       String @id @default(uuid())
  sellerId Int
  title    String

  imageSrc String
  bedrooms String
  rating   Float?
  sf       String
  reviews  Int?
  price    String
  location String

  views    String[]
  overview Json?
  about    String[]

  // Status fields
  saleStatus      PropertySaleStatus      @default(AVAILABLE)
  occupancyStatus PropertyOccupancyStatus @default(VACANT)

  seller User @relation(fields: [sellerId], references: [id])

  // ðŸ”½ REQUIRED opposite relations (THIS FIXES THE ERROR)
  boughtBy   BoughtProperty[]
  wishlisted WishlistProperty[]
  investedBy InvestedProperty[]
  rentedBy   RentedProperty[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ---------------------------
// 6. Userâ€“Property Join Tables
// ---------------------------
model BoughtProperty {
  id         Int    @id @default(autoincrement())
  userId     Int
  propertyId String

  user     User     @relation(fields: [userId], references: [id])
  property Property @relation(fields: [propertyId], references: [id])

  createdAt DateTime @default(now())

  @@unique([userId, propertyId])
}

model WishlistProperty {
  id         Int    @id @default(autoincrement())
  userId     Int
  propertyId String

  user     User     @relation(fields: [userId], references: [id])
  property Property @relation(fields: [propertyId], references: [id])

  createdAt DateTime @default(now())

  @@unique([userId, propertyId])
}

model InvestedProperty {
  id         Int    @id @default(autoincrement())
  userId     Int
  propertyId String

  user     User     @relation(fields: [userId], references: [id])
  property Property @relation(fields: [propertyId], references: [id])

  createdAt DateTime @default(now())

  @@unique([userId, propertyId])
}

model RentedProperty {
  id         Int    @id @default(autoincrement())
  userId     Int
  propertyId String

  user     User     @relation(fields: [userId], references: [id])
  property Property @relation(fields: [propertyId], references: [id])

  createdAt DateTime @default(now())

  @@unique([userId, propertyId])
}

enum TransactionType {
  FUND
  WITHDRAW
}

enum TransactionStatus {
  PENDING
  SUCCESS
  FAILED
}

model Wallet {
  id        Int      @id @default(autoincrement())
  userId    Int      @unique
  balance   Decimal  @default(0)
  currency  String   @default("NGN")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // âœ… FK owner
  user User @relation(fields: [userId], references: [id])

  transactions Transaction[]
}

model Transaction {
  id          Int               @id @default(autoincrement())
  walletId    Int
  type        TransactionType
  amount      Decimal
  reference   String            @unique
  status      TransactionStatus
  paystackRef String?
  channel     String?
  metadata    Json?
  createdAt   DateTime          @default(now())

  // âœ… FK owner
  wallet Wallet @relation(fields: [walletId], references: [id])
}

model BankAccount {
  id            Int      @id @default(autoincrement())
  userId        Int      @unique
  bankName      String
  bankCode      String
  accountNumber String
  accountName   String
  recipientCode String?
  createdAt     DateTime @default(now())

  // âœ… FK owner
  user User @relation(fields: [userId], references: [id])
}
